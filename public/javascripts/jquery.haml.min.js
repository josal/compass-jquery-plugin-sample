(function(e){function l(b,a){if(b===undefined)return a==="undefined";if(b===null)return a==="null";return b.constructor.toString().match(new RegExp(a,"i"))!==null}function p(b,a){if(b&&b[a]){var i=b[a];delete b[a];return i}}function t(b){if(typeof b!=="string"||b.length<2)return false;b=b.charAt(0);if(!(b==="."||b==="#"||b==="%"))return false;return true}function q(b,a){function i(g,c){if(!(c===undefined||c===null))if(c.nodeType||c.jquery)g.append(c);else if(l(c,"String")&&c.length>0){if(c[0]==="\\")c=
c.substr(1);g.append(document.createTextNode(c))}else if(l(c,"Number"))g.append(document.createTextNode(c));else l(c,"Array")&&c.length>0&&q(g,c)}var j,h,d,k,m,f;a=Array.prototype.slice.call(a,0);if(a.length&&a.length>0){if(t(a[0])){d=a.shift();k=d.match(/\.[^\.#]+/g);m=d.match(/#[^\.#]+/g);d=(d=d.match(/^%([^\.#]+)/g))?d[0].substr(1):"div";f=e(document.createElement(d));if(a.length>0&&l(a[0],"Object")){d=a.shift();j=p(d,"css");h=p(d,"$");f.attr(d)}m&&e.each(m,function(){var g,c;g=this.substr(1);
(c=f.attr("id"))?f.attr("id",c+" "+g):f.attr("id",g)});k&&e.each(k,function(){f.addClass(this.substr(1))});j&&f.css(j);b.append(f);b=f;h&&e.each(h,function(g){n.push({node:b,method:g,params:this})})}e.each(a,function(){i(b,this)})}else i(b,a)}function r(){e.each(n,function(){if(this.method==="$")this.params.apply(this.node,[]);else{if(!l(this.params,"Array"))this.params=[this.params];this.node[this.method].apply(this.node,this.params)}});n=[]}function s(b){var a;a=e(document.createElement("div"));
q(a,b);this.append(a.children());this.closest("body").length>0&&r();return a.children()}var n=[],o={};e.fn.insertHaml=function(){return s.call(this,Array.prototype.slice.call(arguments,0))};e.fn.haml=function(){s.call(this,Array.prototype.slice.call(arguments,0));return this};e.haml={placeholder:function(b){function a(){var h=e(document.createElement("div"));h.haml(b.apply(this,arguments));return j=h.children()}function i(){e.each(j,function(h,d){h===0?e(d).replaceWith(a.apply(this,arguments)):e(d).remove()});
r()}var j;return{inject:a,update:i}},onDemand:function(b,a){var i;a=["%div",{style:"text-align: center; cursor: wait"},a||"Loading..."];return function(j){function h(){var k=Util.stringify(d);if(o[k]!==undefined)return j(o[k]);else{function m(f){o[k]=f;i.update()}b.apply(this,[m].concat(d));return a}}var d=Array.prototype.slice.call(arguments,1);return i=e.haml.placeholder(h)}}}})(jQuery);
