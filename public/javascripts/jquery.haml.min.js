(function(d){function l(a,b){if(a===undefined)return b==="undefined";if(a===null)return b==="null";return a.constructor.toString().match(RegExp(b,"i"))!==null}function q(a,b){if(a&&a[b]){var g=a[b];delete a[b];return g}}function u(a){if(typeof a!=="string"||a.length<2)return false;a=a.charAt(0);if(!(a==="."||a==="#"||a==="%"))return false;return true}function r(a,b){function g(h,c){if(!(c===undefined||c===null))if(c.nodeType||c.jquery)h.append(c);else if(l(c,"String")&&c.length>0){if(c[0]==="\\")c=
c.substr(1);h.append(document.createTextNode(c))}else if(l(c,"Number"))h.append(document.createTextNode(c));else l(c,"Array")&&c.length>0&&r(h,c)}var i,j,e,f,m,n,k;e=Array.prototype.slice.call(b,0);if(e.length&&e.length>0){if(u(e[0])){f=e.shift();m=f.match(/\.[^\.#]+/g);n=f.match(/#[^\.#]+/g);f=(f=f.match(/^%([^\.#]+)/g))?f[0].substr(1):"div";k=d(document.createElement(f));if(e.length>0&&l(e[0],"Object")){f=e.shift();i=q(f,"css");j=q(f,"$");k.attr(f)}n&&d.each(n,function(){var h,c;h=this.substr(1);
(c=k.attr("id"))?k.attr("id",c+" "+h):k.attr("id",h)});m&&d.each(m,function(){k.addClass(this.substr(1))});i&&k.css(i);a.append(k);a=k;j&&d.each(j,function(h){o.push({node:a,method:h,params:this})})}d.each(e,function(){g(a,this)})}else g(a,e)}function s(){d.each(o,function(){if(this.method==="$")this.params.apply(this.node,[]);else{if(!l(this.params,"Array"))this.params=[this.params];this.node[this.method].apply(this.node,this.params)}});o=[]}function t(a){var b;b=d(document.createElement("div"));
r(b,a);this.append(b.children());this.closest("body").length>0&&s();return b.children()}var o=[],p={};d.fn.insertHaml=function(){return t.call(this,Array.prototype.slice.call(arguments,0))};d.fn.haml=function(){t.call(this,Array.prototype.slice.call(arguments,0));return this};d.haml={placeholder:function(a){function b(){var i=d(document.createElement("div"));i.haml(a.apply(this,arguments));return g=i.children()}var g;return{inject:b,update:function(){d.each(g,function(i,j){i===0?d(j).replaceWith(b.apply(this,
arguments)):d(j).remove()});s()}}},onDemand:function(a,b){var g;b=["%div",{style:"text-align: center; cursor: wait"},b||"Loading..."];return function(i){var j=Array.prototype.slice.call(arguments,1);return g=d.haml.placeholder(function(){var e=Util.stringify(j);if(p[e]!==undefined)return i(p[e]);else{a.apply(this,[function(f){p[e]=f;g.update()}].concat(j));return b}})}}}})(jQuery);
