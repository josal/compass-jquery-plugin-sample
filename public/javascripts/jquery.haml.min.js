(function(e){function l(b,a){if(b===undefined)return a==="undefined";if(b===null)return a==="null";return b.constructor.toString().match(new RegExp(a,"i"))!==null}function p(b,a){if(b&&b[a]){var h=b[a];delete b[a];return h}}function t(b){if(typeof b!=="string"||b.length<2)return false;b=b.charAt(0);if(!(b==="."||b==="#"||b==="%"))return false;return true}function q(b,a){function h(f,c){if(!(c===undefined||c===null))if(c.nodeType||c.jquery)f.append(c);else if(l(c,"String")&&c.length>0){if(c[0]==="\\")c=
c.substr(1);f.append(document.createTextNode(c))}else if(l(c,"Number"))f.append(document.createTextNode(c));else l(c,"Array")&&c.length>0&&q(f,c)}var j,g,d,k,m,i;a=Array.prototype.slice.call(a,0);if(a.length&&a.length>0){if(t(a[0])){d=a.shift();k=d.match(/\.[^\.#]+/g);m=d.match(/#[^\.#]+/g);d=(d=d.match(/^%([^\.#]+)/g))?d[0].substr(1):"div";i=e(document.createElement(d));if(a.length>0&&l(a[0],"Object")){d=a.shift();j=p(d,"css");g=p(d,"$");i.attr(d)}m&&e.each(m,function(){var f,c;f=this.substr(1);
(c=i.attr("id"))?i.attr("id",c+" "+f):i.attr("id",f)});k&&e.each(k,function(){i.addClass(this.substr(1))});j&&i.css(j);b.append(i);b=i;g&&e.each(g,function(f){n.push({node:b,method:f,params:this})})}e.each(a,function(){h(b,this)})}else h(b,a)}function r(){e.each(n,function(){if(this.method==="$")this.params.apply(this.node,[]);else{if(!l(this.params,"Array"))this.params=[this.params];this.node[this.method].apply(this.node,this.params)}});n=[]}function s(b){var a;a=e(document.createElement("div"));
q(a,b);this.append(a.children());this.closest("body").length>0&&r();return a.children()}var n=[],o={};e.fn.insertHaml=function(){return s.call(this,Array.prototype.slice.call(arguments,0))};e.fn.haml=function(){s.call(this,Array.prototype.slice.call(arguments,0));return this};e.haml={placeholder:function(b){function a(){var g=e(document.createElement("div"));g.haml(b.apply(this,arguments));return j=g.children()}function h(){e.each(j,function(g,d){g===0?e(d).replaceWith(a.apply(this,arguments)):e(d).remove()});
r()}var j;return{inject:a,update:h}},onDemand:function(b,a){var h;a=["%div",{style:"text-align: center; cursor: wait"},a||"Loading..."];return function(j){function g(){var k=Util.stringify(d);if(o[k]!==undefined)return j(o[k]);else{b.apply(this,[function(m){o[k]=m;h.update()}].concat(d));return a}}var d=Array.prototype.slice.call(arguments,1);return h=e.haml.placeholder(g)}}}})(jQuery);
