jQuery.fn.sauce=function(){$(this).find(".sauceDialog").sauceDialog();$(".sauceGrid").sauceGrid();$(".sauceForm").sauceForm();$(".sauceDynTree").sauceDynTree()};$(document).ready(function(){$(document).sauce()});
jQuery.fn.sauceDialog=function(){for(i=0;i<$(this).size();i++){var a=$.evalJSON($(this[i]).attr("dialogOptions"));if($(this[i]).attr("url")!=undefined)if($(this[i]).attr("preload")!=undefined){div=this[i];$.ajax({url:$(this[i]).attr("url"),dataType:"html",success:function(c){$(div).append(c);$(div).sauce()}})}else a.open=function(){var c=this;$.ajax({url:$(this).attr("url"),dataType:"html",success:function(d){$(c).children().remove();$(c).append(d);$(c).sauce()}})};$(this[i]).dialog(a);$(this[i]).css("visibility",
"visible")}};dyntreeOptions={};dyntreeData={};createAddLink=function(a,c){var d=dyntreeOptions[$(a).closest("div.sauceDynTree").attr("sauceDynTreeName")];new_html='<li class="addDynTreeItem"><a href="#" onClick="addDynTreeItem(this, \'\')">              add #{label}</a></li>';new_html=new_html.replace("#{label}",d.levels[c]);$(a).append(new_html)};removeDynTreeItem=function(a){a=$(a).parents("li")[0];$(a).remove()};
addDynTreeItem=function(a,c){var d=dyntreeOptions[$(a).closest("div.sauceDynTree").attr("sauceDynTreeName")],b=a;if(a.tagName!="UL")b=$(a).parents("ul")[0];b=$(b);a=parseInt(b.attr("sauceDynTreeLevel"));var e='<li class="newSauceDynTreeLi sauceDynTreeInput"></li>',f=b.children("li");if(f.length==0)b.append(e);else $(f[f.length-1]).hasClass("addDynTreeItem")?$(f[f.length-1]).before(e):$(f[f.length-1]).after(e);f=$(b.find(".newSauceDynTreeLi"));f.removeClass("newSauceDynTreeLi");e=[];var g,h=b.parents("li").get().reverse();
h[h.length]=f;if(a==0)e=[b.children("li").index(f)];else for(b=0;b<=a;b++){g=h[b];e[b]=$(g).parent().children("li.sauceDynTreeInput").index(g)}g=h="";var k;for(b=0;b<e.length;b++){k=d.levels[b]+"_list";if(b!=0)k="["+k+"]";h+=k;g+=k;g+="["+e[b]+"]";h+="[]"}h+="[value]";g+="[value]";e=d.levels[a]+': <input type="text" id="#{id}" name="#{name}" value="#{val}"/>';if(a>0||d.include_top_level_add_link==true)e+='<a href="#" onClick="removeDynTreeItem(this)">x</a>';e=e.replace("#{id}",g);e=e.replace("#{name}",
h);if(c==undefined)c="";e=e.replace("#{val}",c);f.append(e);if(a<d.levels.length-1){f.append("<ul></ul>");c=f.find("ul")[0];$(c).attr("sauceDynTreeLevel",a+1);createAddLink(c,a+1)}};
function populateDynTreeItem(a,c,d){var b=dyntreeOptions[$(a).closest("div.sauceDynTree").attr("sauceDynTreeName")];addDynTreeItem(a,c.value);if(d<b.levels.length-1){a=$(a).find("li.sauceDynTreeInput");a=$(a[a.length-1]).find("ul")[0];d=d+1;c=c[b.levels[d]+"_list"];for(b=0;b<c.length;b++)populateDynTreeItem(a,c[b],d)}}
jQuery.fn.sauceDynTree=function(){for(i=0;i<$(this).size();i++){var a=$(this[i]),c=$.evalJSON(a.attr("sauceDynTreeOptions"));dyntreeOptions[c.levels[0]]=c;var d=$.evalJSON(a.attr("sauceDynTreeData"));dyntreeData[c.levels[0]]=d;a.attr("sauceDynTreeName",c.levels[0]);a.html("");a.append('<ul sauceDynTreeLevel="0"></ul>');a=a.find("ul")[0];var b=c.levels[0]+"_list";if(d!=undefined&&d[b]!=undefined)for(j=0;j<d[b].length;j++)populateDynTreeItem(a,d[b][j],0);else addDynTreeItem(a);c.include_top_level_add_link==
true&&createAddLink(a,0)}};
jQuery.fn.sauceForm=function(){for(i=0;i<$(this).size();i++){var a=$(this[i]).find(".sauceSubmit");if($(a).parent().parent().hasClass("ui-dialog-content")){var c=$(a).parent();$(a).parent().parent().parent().append("<div class='ui-dialog-buttonpane ui-widget-content ui-helper-clearfix'></div>");$(a).parent().parent().parent().find(".ui-dialog-buttonpane").append($(a).clone());$(a).css("visibility","hidden");a=$(a).parent().parent().parent().find(".ui-dialog-buttonpane").find(".sauceSubmit");$(a).addClass("ui-state-default ui-corner-all");
$(a).click(function(){$(c).submit()})}}$.each($(".sauceDate"),function(){var d=$.evalJSON($(this).attr("dateOptions"));$(this).datepicker(d)})};$(document).ready(function(){$(".ui-state-default").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})});
jQuery.fn.sauceGrid=function(){for(i=0;i<$(this).size();i++){var a=$.evalJSON($(this[i]).attr("gridOptions")),c=$(this[i]).attr("id").split("_");a.loadComplete=function(){$(".sauceGridAssociation").unbind("click");$(".sauceGridAssociation").bind("click",function(){var b=$(this[i]).attr("id").split("_");$.ajax({url:b[2],method:"get",dataType:"html",data:{association_model:b[0],association_id:b[1]},success:function(e){$("#"+b[2]+"_table_dialog").append(e);$("#"+b[2]+"_grid").buildGrid();$("#"+b[2]+
"_table_dialog").dialog({modal:true,draggable:false,resizable:false,height:"auto",width:"auto",title:b[0].singularize().capitalize()+" "+b[1]+" "+b[2].capitalize(),close:function(){$(this[i]).dialog("destroy");$("#"+b[2]+"_table_dialog").children().remove()}})}})})};$(this[i]).jqGrid(a).navGrid("#"+$(this[i]).attr("id")+"_pager",$.evalJSON($(this[i]).attr("navOptions")));if($("#"+c[0]+"_destroy_dialog").size()>0){var d=$("#"+c[0]+"_update_dialog");$(this[i]).navButtonAdd("#"+$(this[i]).attr("id")+
"_pager",{caption:"",position:"first",buttonicon:"ui-icon-trash",onClickButton:function(){var b=$("#"+c[0]+"_grid").getGridParam("selrow");if(b==null)alert("You must first select a row.");else confirm("Are you sure?")&&$.ajax({url:c[0]+"/"+b,type:"delete",data:{authenticity_token:$("#"+c[0]+"_destroy_dialog").attr("authenticity_token")},success:function(){$("#"+c[0]+"_grid").trigger("reloadGrid")}})}})}if($("#"+c[0]+"_update_dialog").size()>0){d=$("#"+c[0]+"_update_dialog");$(this[i]).navButtonAdd("#"+
$(this[i]).attr("id")+"_pager",{caption:"",position:"first",buttonicon:"ui-icon-pencil",onClickButton:function(){var b=$("#"+c[0]+"_grid").getGridParam("selrow");b==null?alert("You must first select a row."):$.ajax({method:"get",url:c[0]+"/"+$(d).attr("action")+"/"+b,dataType:"html",success:function(e){var f=$(e).css("width"),g=$(e).css("height");if($(e).is("form")){$(d).find("form").size()>0?$(d).find("form").replaceWith(e):$(d).append(e);$(d).find("#"+c[0].singularize()+"_submit").hide()}else{$(d).dialog("close");
$("#"+c[0]+"_grid").trigger("reloadGrid")}$(d).dialog({buttons:{Save:function(){$(this).find("form").submit()},Cancel:function(){$(this).dialog("close")}},title:"Edit",width:f,height:g,modal:true,draggable:false,resizable:false,close:function(){$(this[i]).dialog("destroy");$(d).children().remove()}})}})}})}if($("#"+c[0]+"_create_dialog").size()>0){d=$("#"+c[0]+"_create_dialog");$(this[i]).navButtonAdd("#"+$(this[i]).attr("id")+"_pager",{caption:"",position:"first",buttonicon:"ui-icon-plus",onClickButton:function(){$.ajax({method:"get",
url:c[0]+"/"+$(d).attr("action"),dataType:"html",success:function(b){var e=$(b).css("width"),f=$(b).css("height");if($(b).is("form")){$(d).find("form").size()>0?$(d).find("form").replaceWith(b):$(d).append(b);$(d).find("#"+c[0].singularize()+"_submit").hide()}else{$(d).dialog("close");$("#"+c[0]+"_grid").trigger("reloadGrid")}$(d).dialog({buttons:{Save:function(){$(this).find("form").submit()},Cancel:function(){$(this).dialog("close")}},title:"Edit",width:e,height:f,modal:true,draggable:false,resizable:false,
close:function(){$(this[i]).dialog("destroy")}})}})}})}}};
