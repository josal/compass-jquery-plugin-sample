<!doctype html>
%html
  %head
    %title
      jQuery UI Autocomplete Remote with caching demo
    %link{ :href => "../../themes/base/jquery.ui.all.css", :rel => "stylesheet", :type => "text/css" }
    %script{ :type => "text/javascript", :src => "../../jquery-1.4.2.js" }
    %script{ :type => "text/javascript", :src => "../../ui/jquery.ui.core.js" }
    %script{ :type => "text/javascript", :src => "../../ui/jquery.ui.widget.js" }
    %script{ :type => "text/javascript", :src => "../../ui/jquery.ui.position.js" }
    %script{ :type => "text/javascript", :src => "../../ui/jquery.ui.autocomplete.js" }
    %link{ :href => "../demos.css", :rel => "stylesheet", :type => "text/css" }
    %script{ :type => "text/javascript" }
      $(function() {
      function log(message) {
      $("
      %div
      ").text(message).prependTo("#log");
      $("#log").attr("scrollTop", 0);
      }
      
      var cache = {};
      $("#birds").autocomplete({
      source: function(request, response) {
      if (cache.term == request.term && cache.content) {
      response(cache.content);
      }
      if (new RegExp(cache.term).test(request.term) && cache.content && cache.content.length < 13) {
      var matcher = new RegExp($.ui.autocomplete.escapeRegex(request.term), "i");
      response($.grep(cache.content, function(value) {
      return matcher.test(value.value)
      }));
      }
      $.ajax({
      url: "search.php",
      dataType: "json",
      data: request,
      success: function(data) {
      cache.term = request.term;
      cache.content = data;
      response(data);
      }
      });
      },
      minLength: 2,
      select: function(event, ui) {
      log(ui.item ? ("Selected: " + ui.item.value + " aka " + ui.item.id) : "Nothing selected, input was " + this.value);
      }
      });
      });
  %body
    .demo
      .ui-widget
        %label{ :for => "birds" }
          Birds:
        %input#birds
      .ui-widget{ :style => "margin-top:2em; font-family:Arial" }
        Result:
        #log.ui-widget-content{ :style => "height: 200px; width: 300px; overflow: auto;" }
    /
      End demo
    .demo-description
      %p
        The Autocomplete widgets provides suggestions while you type into the field. Here the suggestions are bird names, displayed when at least two characters are entered into the field.
      %p
        Similar to the remote datasource demo, though this adds some local caching to improve performance. The cache here saves just one query, and could be extended to cache multiple values, one for each term.
    /
      End demo-description
