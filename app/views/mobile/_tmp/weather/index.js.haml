<?
$location = isset($_GET['location']) ? $_GET['location'] : '02135';

\//get xml from google api
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, 'http://www.google.com/ig/api?weather='. $location);
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_TIMEOUT, 10);
$result = curl_exec($ch);
curl_close($ch);

\//parse xml (thx KomunitasWeb.com for pointers)
$xml = simplexml_load_string($result);
$information = $xml->xpath("/xml_api_reply/weather/forecast_information");
$current = $xml->xpath("/xml_api_reply/weather/current_conditions");
$forecast_list = $xml->xpath("/xml_api_reply/weather/forecast_conditions");
?>
!!!
%html
  %head
    %meta{:charset => "utf-8"}/
    %title jQuery Mobile Framework - Weather for <?= $information[0]->city['data']; ?>
    %link{:href => "../../themes/default/", :rel => "stylesheet"}/
    %script{:src => "http://code.jquery.com/jquery-1.4.4.min.js"}
    %script{:src => "http://code.jquery.com/mobile/1.0a2/jquery.mobile-1.0a2.min.js"}
    :css
      .current { text-align: left; }
      h1 { font-size: 1.3em; text-align: center;  }
      .ui-listview img { left: auto; margin: 10px; position: absolute; right: 10px; }
      .current { position: relative; }
      .current img { float: left; margin: 5px 10px 0 0; }
      .current p { font-weight: bold; font-size: 1.1em; margin-left: 20px; }
      .ui-mobile label { position: absolute; left: -9999px; }
      .ui-input-search, .min-width-480px .ui-input-search { margin: 5px auto; width: auto; float: none; display: block; }
	    :javascript
      $('div').live('pagecreate',function(){
      	$('.ui-listview img').removeClass('ui-corner-bl');
      });
	  %body
    %div{"data-role" => "page", "data-theme" => "a"}
      %form.ui-body.ui-body-a{:action => "", :method => "get"}
        %label{:for => "location"} Change zip code:
        %input#location{"data-theme" => "a", :name => "location", :placeholder => "zip code...", :type => "search", :value => "<?=$location; ?>"}/
        %input{"data-role" => "nojs", :type => "submit", :value => "submit"}/
      %div{"data-role" => "content"}
        %h1 Currently in <?=$information[0]->city['data']; ?>:
        .current.ui-body.ui-bar-a.ui-corner-all
          %img{:alt => "weather", :src => "<?= 'http://www.google.com' . $current[0]->icon['data']?>"}
            %p.condition
              <?= $current[0]->temp_f['data'] ?>&deg; F,
              <?= $current[0]->condition['data'] ?>
        %ul{"data-inset" => "true", "data-role" => "listview", "data-theme" => "a"}
          %li{"data-role" => "list-divider"} This week's forecast
          <? foreach ($forecast_list as $forecast) : ?>
          %li
            %img{:src => "<?= 'http://www.google.com' . $forecast->icon['data']?>"}
              %h3 <?= $forecast->day_of_week['data']; ?>
              %p
                <?= $forecast->low['data'] ?>&deg; F - <?= $forecast->high['data'] ?>&deg; F,
                <?= $forecast->condition['data'] ?>
          <? endforeach ?>
