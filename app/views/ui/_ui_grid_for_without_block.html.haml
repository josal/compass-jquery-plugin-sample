%script{ :type => "text/javascript" }
  jQuery(document).ready(function() {
  jQuery('#
  = name
  _table').jqGrid(
  = options.to_json
  ).navGrid("#
  = name
  _pager",
  = nav.to_json
  );
  - if actions
  - if actions[:destroy]
  jQuery("#
  = name
  _table").navButtonAdd("#
  = name
  _pager", {
  caption: "",
  position: "first",
  buttonicon: "ui-icon-trash",
  onClickButton: function() {
  var rowId = jQuery("#
  = name
  _table").getGridParam("selrow")
  if(rowId == null) {
  alert("You must first select a row.");
  } else {
  var sure = confirm("Are you sure?")
  if(sure) {
  jQuery.ajax({
  url: "
  = name
  \/"+rowId,
  type: "delete",
  data: {authenticity_token: "
  = form_authenticity_token
  "},
  success: function() {
  jQuery("#
  = name
  _table").trigger("reloadGrid");
  }
  });
  }
  }
  }
  });
  - end
  - if actions[:update]
  jQuery("#
  = name
  _table").navButtonAdd("#
  = name
  _pager", {
  caption: "",
  position: "first",
  buttonicon: "ui-icon-pencil",
  onClickButton: function() {
  var rowId = jQuery("#
  = name
  _table").getGridParam("selrow")
  if(rowId == null) {
  alert("You must first select a row.");
  } else {
  jQuery.ajax({
  method: "get",
  url: "/
  = name
  = actions[:update]
  \/"+rowId,
  success: function(data, status) {
  var dWidth = jQuery(data).css("width")
  var dHeight = jQuery(data).css("height")
  jQuery("#
  = name
  _update_dialog").append(data)
  jQuery("#widget_submit").hide(); // HACK: easy way to make submit on enter work
  jQuery("#
  = name
  _update_dialog").find("form").submit(function() {
  jQuery(this).ajaxSubmit({
  url: jQuery(this).attr("action"),
  data: jQuery(this).serialize(),
  type: "put",
  success: function(response, status) {
  if(!jQuery(response).is("form")) {
  jQuery("#
  = name
  _update_dialog").dialog('close');
  jQuery("#
  = name
  _table").trigger("reloadGrid");
  } else {
  jQuery("#
  = name
  _update_dialog").find("form").replaceWith(response);
  }
  }
  });
  return false;
  });
  jQuery("#
  = name
  _update_dialog").dialog({
  buttons: {
  "Save": function() {jQuery(this).find("form").submit();},
  "Cancel": function() {jQuery(this).dialog('close');}
  },
  title: "Edit",
  width: dWidth,
  height: dHeight,
  modal: true,
  draggable: false,
  resizable: false,
  close: function() {
  jQuery(this).dialog('destroy');
  jQuery("#
  = name
  _update_dialog").children().remove();
  }
  });
  }
  });
  }
  }
  });
  - end
  - if actions[:create]
  jQuery("#
  = name
  _table").navButtonAdd("#
  = name
  _pager", {
  caption: "",
  position: "first",
  buttonicon: "ui-icon-plus",
  onClickButton: function() {
  jQuery.ajax({
  method: "get",
  url: "/
  = name
  = actions[:create]
  ",
  success: function(data, status) {
  var dWidth = jQuery(data).css("width");
  var dHeight = jQuery(data).css("height");
  jQuery("#
  = name
  _create_dialog").append(data);
  jQuery("#widget_submit").hide(); // HACK: easy way to make submit on enter work
  jQuery("#
  = name
  _create_dialog").find("form").submit(function() {
  jQuery(this).ajaxSubmit({
  url: jQuery(this).attr("action"),
  data: jQuery(this).serialize(),
  type: "post",
  success: function(response, status) {
  if(!jQuery(response).is("form")) {
  jQuery("#
  = name
  _create_dialog").dialog('close');
  jQuery("#
  = name
  _table").trigger("reloadGrid");
  } else {
  jQuery("#
  = name
  _create_dialog").find("form").replaceWith(response);
  }
  }
  });
  return false;
  });
  jQuery("#
  = name
  _create_dialog").dialog({
  buttons: {
  "Save": function() {jQuery(this).find("form").submit();},
  "Cancel": function() {jQuery(this).dialog('close');}
  },
  title: "New",
  width: dWidth,
  height: dHeight,
  modal: true,
  draggable: false,
  resizable: false,
  close: function() {
  jQuery(this).dialog('destroy');
  jQuery("#
  = name
  _create_dialog").children().remove();
  }
  });
  }
  });
  }
  });
  - end
  - end
  });
